{"version":3,"file":"formsController.js","sources":["src/controllers/formsController.ts"],"sourceRoot":"/","sourcesContent":["// Controller for forms endpoints\nimport express from \"express\";\nimport {\n  ServiceCreateFormApproval,\n  ServiceCreateFormSubmission,\n  ServiceDeleteFormSubmission,\n  ServiceSaveDraft,\n  ServiceSaveDraftToPending,\n  ServiceSavePending,\n  ServiceUpdateFormApproval,\n} from \"../services/formsService.js\";\n\nexport const createFormSubmission = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const { formTemplateId, userId } = req.body;\n    const submission = await ServiceCreateFormSubmission({\n      formTemplateId,\n      userId,\n    });\n    res.status(201).json(submission);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to create form submission\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const deleteFormSubmission = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const id = Number(req.params.id);\n    await ServiceDeleteFormSubmission(id);\n    res.status(200).json({ success: true });\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to delete form submission\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const saveDraft = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const { formData, formTemplateId, userId, formType, submissionId, title } =\n      req.body;\n    const result = await ServiceSaveDraft({\n      formData,\n      formTemplateId,\n      userId,\n      formType,\n      submissionId,\n      title,\n    });\n    res.status(200).json(result);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to save draft\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const saveDraftToPending = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const {\n      formData,\n      isApprovalRequired,\n      formTemplateId,\n      userId,\n      formType,\n      submissionId,\n      title,\n    } = req.body;\n    const result = await ServiceSaveDraftToPending({\n      formData,\n      isApprovalRequired,\n      formTemplateId,\n      userId,\n      formType,\n      submissionId,\n      title,\n    });\n    res.status(200).json(result);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to save draft to pending\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const savePending = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const { formData, formTemplateId, userId, formType, submissionId, title } =\n      req.body;\n    const result = await ServiceSavePending({\n      formData,\n      formTemplateId,\n      userId,\n      formType,\n      submissionId,\n      title,\n    });\n    res.status(200).json(result);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to save pending submission\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const createFormApproval = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const { formSubmissionId, signedBy, signature, comment, approval } =\n      req.body;\n    const result = await ServiceCreateFormApproval({\n      formSubmissionId,\n      signedBy,\n      signature,\n      comment,\n      approval,\n    });\n    res.status(201).json(result);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to create form approval\";\n    res.status(400).json({ message });\n  }\n};\n\nexport const updateFormApproval = async (\n  req: express.Request,\n  res: express.Response\n) => {\n  try {\n    const { id, formSubmissionId, comment, isApproved } = req.body;\n    const result = await ServiceUpdateFormApproval({\n      id,\n      formSubmissionId,\n      comment,\n      isApproved,\n    });\n    res.status(200).json(result);\n  } catch (error) {\n    const message =\n      error instanceof Error && error.message\n        ? error.message\n        : \"Failed to update form approval\";\n    res.status(400).json({ message });\n  }\n};\n"],"names":[],"mappings":"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","debug_id":"b1ab0451-6da4-5adc-b0e6-9e0e20d3a43a"}