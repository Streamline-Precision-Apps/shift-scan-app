{"version":3,"file":"tokenController.js","sources":["src/controllers/tokenController.ts"],"sourceRoot":"/","sourcesContent":["import type { AuthenticatedRequest } from \"../middleware/authMiddleware.js\";\nimport type { Request, Response } from \"express\";\nimport prisma from \"../lib/prisma.js\";\n\nexport async function saveFCMToken(req: AuthenticatedRequest, res: Response) {\n  const userId = req.user?.id; // assuming verifyToken middleware sets req.user\n  const { token } = req.body;\n\n  if (!userId) {\n    return res\n      .status(401)\n      .json({ success: false, error: \"No authenticated user\" });\n  }\n  if (!token) {\n    return res.status(400).json({ success: false, error: \"No token provided\" });\n  }\n\n  try {\n    await prisma.fCMToken.deleteMany({ where: { userId } });\n    await prisma.fCMToken.create({\n      data: {\n        token,\n        userId,\n        platform: \"web\",\n        lastUsedAt: new Date(),\n        isValid: true,\n      },\n    });\n    return res.json({ success: true });\n  } catch (error) {\n    console.error(\"Error saving FCM token:\", error);\n    return res\n      .status(500)\n      .json({ success: false, error: \"Failed to save FCM token\" });\n  }\n}\n"],"names":[],"mappings":";;AAEA,OAAO,MAAM,MAAM,kBAAkB,CAAC;AAEtC,MAAM,CAAC,KAAK,UAAU,YAAY,CAAC,GAAyB,EAAE,GAAa;IACzE,MAAM,MAAM,GAAG,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,gDAAgD;IAC7E,MAAM,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;IAE3B,IAAI,CAAC,MAAM,EAAE,CAAC;QACZ,OAAO,GAAG;aACP,MAAM,CAAC,GAAG,CAAC;aACX,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC,CAAC;IAC9D,CAAC;IACD,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,mBAAmB,EAAE,CAAC,CAAC;IAC9E,CAAC;IAED,IAAI,CAAC;QACH,MAAM,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,CAAC,CAAC;QACxD,MAAM,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC3B,IAAI,EAAE;gBACJ,KAAK;gBACL,MAAM;gBACN,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,IAAI,IAAI,EAAE;gBACtB,OAAO,EAAE,IAAI;aACd;SACF,CAAC,CAAC;QACH,OAAO,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;IACrC,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;QAChD,OAAO,GAAG;aACP,MAAM,CAAC,GAAG,CAAC;aACX,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,0BAA0B,EAAE,CAAC,CAAC;IACjE,CAAC;AACH,CAAC","debug_id":"4b0bd67a-77fb-566b-acc5-3e671f4d026a"}